# AI Session Context for Mixtape Backend Project

## General Instructions and Project State (as of 2025-04-26)

### Project Overview
- Build, automate, and test a scalable backend for a web app ("mixtape") for musicians to upload, share, and stream audio files and playlists.
- Stack: Node.js/TypeScript/Express, PostgreSQL, local file storage.
- Focus: Robust engineering scripts, CI/CD, documentation, test automation, code quality, and local/CI parity.

### Key Features Implemented
- Audio upload, streaming, static file serving, and DELETE endpoint.
- Automated setup: DB setup/migration, server start/stop, status checks.
- All file storage in `_server-data/uploads/`.
- End-to-end test (`tests/test-seed-and-stream.ts`) for full CRUD, streaming, and download.
- ESLint (flat config) and Prettier; scripts in backend and root `package.json`.
- Local CI script (`run-local-ci.sh`) replicates GitHub Actions workflow.
- GitHub Actions workflow for CI/CD, using secrets for DB credentials.
- `.env` and scripts use environment variables for DB credentials.
- ID3 metadata extraction using `music-metadata`, stored in `id3` JSONB column in `tracks` table.
- PATCH `/api/tracks/:id` endpoint to edit track metadata.
- GET `/api/tracks/:id` endpoint to fetch a single track.
- Custom `/uploads/:filename` route updates ID3 tags on download to match DB and sets download filename to current track title.
- Tests verify metadata editing, ID3 tag correctness, and download filename.
- Test suite cleans up after itself and is robust/readable.

### Recent Fixes and Refactoring
- Fixed test logic to check ID3 tags after each PATCH, not after both edits.
- Removed duplicate test logic and ensured only one place for ID3 download checks.
- Added whitespace and section comments to test file for readability.
- Ensured `node-id3` is imported at the top of the test file.

### Pending/Next Steps
- No major tasks pending. All requested features and test robustness have been implemented and verified.
- This file should be updated if new features, test strategies, or engineering conventions are added.

---

## How to Resume This Session
- Review this file for the latest project state and AI instructions.
- Continue using the same conventions for test structure, endpoint design, and automation.
- If you need to re-initialize the AI with this context, provide this file as a summary of the session so far.

---

*This file was generated by GitHub Copilot at the user's request to preserve session context for future work.*
